<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Client</title>
    </head>
    <body>
        <!DOCTYPE html>
        <style>
            textarea {
                vertical-align: bottom;
            }
            #output {
                overflow: auto;
            }
            #output > p {
                overflow-wrap: break-word;
            }
            #output span {
                color: blue;
            }
            #output span.error {
                color: red;
            }
        </style>
        <h2>WebSocket Test</h2>
        <textarea cols="60" rows="6"></textarea>
        <button id="send">send</button>
        <button id="disconnect">disconnect</button>
        <div id="output"></div>
        <script>
            // http://www.websocket.org/echo.html

            let socketOpen = false;

            var button = document.querySelector("#send"),
                discButton = document.querySelector("#disconnect"),
                output = document.querySelector("#output"),
                textarea = document.querySelector("textarea"),
                // wsUri = "ws://echo.websocket.org/",
                wsUri = "ws://127.0.0.1/",
                websocket = new WebSocket(wsUri);

            button.addEventListener("click", onClickButton);
            discButton.addEventListener("click", () => {
                websocket.close();
            })

            websocket.onopen = function (e) {
                socketOpen = true;
                writeToScreen("CONNECTED");
                doSend("WebSocket rocks");
            };

            websocket.onclose = function (e) {
                socketOpen = false;
                writeToScreen("DISCONNECTED");
            };

            websocket.onmessage = function (e) {
                writeToScreen("<span>RESPONSE: " + e.data + "</span>");
            };

            websocket.onerror = function (e) {
                writeToScreen("<span class=error>ERROR:</span> " + e.data);
            };

            function doSend(message) {
                if(socketOpen) {
                    writeToScreen("SENT: " + message);
                    websocket.send(message);
                } else {
                    writeToScreen("Connection closed!");
                }
            }

            function writeToScreen(message) {
                output.insertAdjacentHTML(
                    "afterbegin",
                    "<p>" + message + "</p>"
                );
            }

            function onClickButton() {
                var text = textarea.value;

                text && doSend(text);
                textarea.value = "";
                textarea.focus();
            }
        </script>
    </body>
</html>
